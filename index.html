<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      Bookmarks descriptions and API
    </title>
    <script src="http://www.w3.org/Tools/respec/respec-w3c-common" class=
    "remove">
</script>
    <script src="respecConfig.js" class='remove'>
</script>
    <style class='remove'>
a:not(href){ color: red }
    li{
        padding: .5em 0;
    }
    </style>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This specification defines a <dfn>bookmark description document</dfn>
        (BDD), which is a JSON document that a user agent can use to provide
        enhanced bookmarking capabilities. Unlike regular bookmarks, this
        specification allows developers to specify a range of icons, the name
        of the web application, as well as the url to launch when a website is
        bookmarked to, for example, the homescreen of a device. It also defines
        a special "standalone" mode in which applications can be launched,
        which is intended to allow web applications to run independently of a
        web browser and more tightly integrate with native application
        environments.
      </p>
      <p>
        This specification also defines two ways to allows a web page to be
        associated with a bookmark description document: through the
        <code>bookmard-description</code> link type or through an API.
      </p>
    </section>
    <section id="sotd">
      <p>
        Implementors should be aware that this specification is not stable.
        <strong>Implementors who are not taking part in the discussions are
        likely to find the specification changing out from under them in
        incompatible ways.</strong> Vendors interested in implementing this
        specification before it eventually reaches the Candidate Recommendation
        phase should join the aforementioned mailing lists and take part in the
        discussions.
      </p>
    </section>
    <section id="conformance">
      <p>
        There is only one class of product that can claim conformance to this
        specification: a <dfn>user agent</dfn>.
      </p>
    </section>
    <section>
      <h2>
        Introduction
      </h2>
      <p>
        Ideally, web applications should be immediately available to users
        without them needing to launch a separate application (a web browser)
        and having to type a URL. A user may have found a web application
        through browsing the web (e.g., through a search engine, via a link
        given to them by a friend on a social network, or through a website
        that works as an "app store"), but once added to the homescreen, the
        developer needs to be able to control if in web application opens in a
        Web browser environment or if the application is launched
        <a>standalone</a>: that is, once the application is launched, it
        appears indistinguishable from a native application by allowing the OS
        to treat it as equivalent to a native application. This includes, but
        is not limited to, integration with OS facilities such as the task
        switcher and doing away with browser UI chrome (the address bar,
        forward/back buttons, etc.).
      </p>
      <p>
        This document attempts to address the <cite><a href=
        "http://w3c-webmob.github.io/installable-webapps/">Use Cases and
        Requirements for Installable Web Apps</a></cite>.
      </p>
      <section class="informative">
        <h3>
          Example bookmark description document
        </h3>
        <p>
          The following shows a typical <a>bookmark description document</a>.
        </p>
        <pre class="example highlight json">
{
  "name": "Example",
  "altname": "The Example App 2.0",
  "orientation": "landscape",
  "url": "/start.html",
  "mode": "standalone",
  "icons": [{
    "src": "icon/lowres",
    "density": "1",
    "width": "64",
    "type": "image/webp"
  }, {
    "src": "icon/hd",
    "density": "2",
    "width": "64"
  }]
}
</pre>
      </section>
      <section>
        <h3>
          Example of linking to bookmark description document
        </h3>
        <p>
          Example of using a <code>link</code> element to associate a website
          with a bookmark description document. The example also shows how HTML
          fallbacks, such as "<span class=
          "example highlight html">application-name</span>", can be used to
          support legacy user agents that don't implement this specification.
        </p>
        <pre class="example highlight html">
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;The Best News - international&lt;/title&gt;

&lt;!-- link to bookmark metadata --&gt; 
&lt;link rel="bookmark-description" href="add_to_homescreen.json"&gt;

&lt;!-- fallback metadata for legacy browsers --&gt;
&lt;meta name="application-name" content="Best News!"&gt;
&lt;link rel="shortcut icon" src="favicon.ico"&gt;
&lt;/head&gt;
...
</pre>
      </section>
      <section>
        <h3>
          Example of using the API
        </h3>
        <p>
        Check if the application is running in <a>standalone</a> mode. </p>
        <pre class="example highlight html">
&lt;script&gt;
if("standalone" in window.navigator &amp;&amp; window.navigator.standalone){
   //Do standalone specific stuff...
   document.documentElement.classList.add("standalone");
}
&lt;/script&gt;
</pre>
      </section>
      <section>
        <h3>
          Request adding to homescreen
        </h3>
        <p>
          Let the user bookmark the application through clicking a button.
        </p>
        <pre class="example highlight html">
&lt;script&gt;
var installButton = document.querySelector("#install");

//Bookmarking only works if initiated by user interaction
installButton.addEventListener("click", function(e){
   window.navigator.bookmark("path/to/bookmark.json");
});
&lt;/script&gt;

&lt;button id="install"&gt;
  Bookmark &lt;b&gt;Awesome App!&lt;/b&gt;
&lt;/button&gt;
</pre>
      </section>
      <section>
        <h3>
          Modes of operation
        </h3>
        <p>
          The <dfn>mode of operation</dfn> in which a web application can be
          launched include:
        </p>
        <dl>
          <dt>
            <dfn>standalone</dfn>
          </dt>
          <dd>
            Once launched, the Web application appears indistinguishable from a
            native application by allowing the OS to treat it as equivalent to
            a native application.
          </dd>
          <dt>
            <dfn>bookmark</dfn>
          </dt>
          <dd>
            When launched, the user agent open the URL is normal (e.g., opens a
            new tab, or a new window, or whatever it commonly does when
            instructed to open a bookmark).
          </dd>
        </dl>
      </section>
    </section>
    <section>
      <h2>
        Bookmark description document
      </h2>
      <p>
        A <em>bookmark description document</em> is a [[!JSON]] document that
        consists of a top-level object (the bookmark description document
        <dfn>root</dfn>) and one or more members, some of which contain other
        objects. Each of the members, as well as how their values are
        processes, are defined below.
      </p>
      <p id="ecmascript-abstractop">
        Algorithms in this specification use the conventions described in
        [[!ECMASCRIPT]], such as the use of steps and sub-steps, and so on. The
        <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-parsefloat-string">
        <dfn>parseFloat</dfn></a> method, <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.8"><dfn>ToString</dfn></a>
        abstract operation, and the <a class="external" href=
        "http://people.mozilla.org/~jorendorff/es6-draft.html#sec-ecmascript-data-types-and-values">
        Type(<var>x</var>)</a> notation referenced in this section are defined
        in [[!ECMASCRIPT]]. Processing also relies on various algorithms
        defined in [[!HTML]], [[!FETCH]], and [[!URL]].
      </p>
      <p>
        As the bookmark description document format is a [[!JSON]] document,
        this specification relies on the types defined in [[!JSON]]
        specification: namely <dfn id="json-object">object</dfn>, <dfn id=
        "json-array">array</dfn>, <dfn id="json-number">number</dfn>, and
        <dfn id="json-string">string</dfn>. Strict type checking is not
        enforced by this specification. Instead, each member's definition
        specifies the steps required to process a particular member.
      </p>
      <p>
        In the algorithms, to <dfn>ignore</dfn> means that the user agent MUST
        act as if the developer had not declared the particular member in the
        bookmark description document document.
      </p>
      <section>
        <h3>
          <code title="">name</code> member
        </h3>
        <p>
          The <dfn id="member-name"><code>name</code></dfn> is a string that
          represents the name of the application as is usually displayed to the
          user (e.g., amongst a list of other applications, or as a label
          underneath an icon).
        </p>
        <p>
          The <dfn>steps for processing the name member</dfn> is given by the
          following algorithm. The algorithm takes a bookmark description
          document as an argument and returns either an error or a string:
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>bookmark
          description</var> passing "<code>name</code>" as the argument.
          </li>
          <li>If <var>value</var> is <code>null</code> or
          <code>undefined</code>, then return <code>undefined</code>.
          </li>
          <li>Let <var>result</var> be the result of calling
          <a>ToString</a>(<var>value</var>)
          </li>
          <li>
            <a href=
            "http://www.whatwg.org/specs/web-apps/current-work/#strip-leading-and-trailing-whitespace">
            Strip leading and trailing whitespace</a> from <var>result</var>.
          </li>
          <li>Return the <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">altname</code> member
        </h3>
        <p>
          The <dfn id="member-short-name"><code>altname</code></dfn> is a
          string that represents an alternative name of the application, such
          as the name under which the application is sold or marketed.
        </p>
        <p>
          The <dfn>steps for processing the short name member</dfn> is given by
          the following algorithm. The algorithm takes a bookmark description
          document as an argument and returns a string:
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>bookmark
          description</var> passing "<code>altname</code>" as the argument.
          </li>
          <li>If <var>value</var> is <code>null</code> or
          <code>undefined</code>, then return <code>undefined</code>.
          </li>
          <li>Let <var>result</var> be the result of calling
          <a>ToString</a>(<var>value</var>).
          </li>
          <li>
            <a href=
            "http://www.whatwg.org/specs/web-apps/current-work/#strip-leading-and-trailing-whitespace">
            Strip leading and trailing whitespace</a> from <var>result</var>.
          </li>
          <li>Return the <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>dont-share-cookies-and-stuff</code> member
        </h3>
        <p>
          Yes, this needs to be renamed.
        </p>
        <p>
          The <code>dont-share-cookies-and-stuff</code> member is a boolean
          that allows a developer to request that the user agent treat this web
          application as independent from the one in the web browser.
          Effectively, this means that cookies, storage, and permissions are
          not shared with the origin from which the application was bookmarked.
          The value of this member is only applicable to applications whose
          <a>mode of operation</a> is <a>standalone</a>.
        </p>
        <p>
          The <dfn>steps for processing the
          <code>dont-share-cookies-and-stuff</code> member</dfn> is given by
          the following algorithm:
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>bookmark
          description</var> passing "<code>dont-share-cookies-and-stuff</code>"
          as the argument.
          </li>
          <li>Let <var>result</var> be the result of calling
          <a><a>ToBoolean</a></a>(<var>value</var>).
          </li>
          <li>Return the <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>url</code> member
        </h3>
        <p>
          The <dfn id="member-launch_path">url</dfn> <a>member</a> is the URL
          that is is <a href=
          "http://www.w3.org/html/wg/drafts/html/master/single-page.html#browsers">
          loaded</a> when the application is <a>launched</a>. When it's missing
          from the bookmark description document, the UA loads the URL from the
          bookmark description doccument was fetched.
        </p>
        <p>
          The <dfn>steps for processing the <code>url</code> member</dfn> are
          given by the following algorithm. The algorithm returns a <a href=
          "http://url.spec.whatwg.org/#concept-url">URL</a>.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of the <var>bookmark description
          document</var> passing "<code>url</code>" as the argument.
          </li>
          <li>Let <var>bookmark description URL</var> be the URL from which the
          <var>bookmark description document</var> was fetched from.
          </li>
          <li>If <var>value</var> is <code>null</code> or
          <code>undefined</code> or <a>Type</a>(<var>value</var>) is not
          "string":
            <ol>
              <li>Let <var>result</var> be <var>bookmark description URL</var>.
              </li>
            </ol>
          </li>
          <li>Otherwise:
            <ol>
              <li>
                <a href="http://url.spec.whatwg.org/#parsing">Parse</a>
                <var>value</var>, using <var>bookmark description URL</var> as
                the base URL, and let <var>result</var> be the result.
              </li>
            </ol>
          </li>
          <li>Return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">icons</code> member
        </h3>
        <p>
          The <dfn id="member-icons">icons</dfn> is a list of <a>icon
          objects</a> that represents a set of icons that the application can
          make use.
        </p>
        <p>
          The <dfn>steps for processing the <code>icons</code> member</dfn> are
          given by the following algorithm. The algorithm returns a list of
          icons, which can be empty.
        </p>
        <ol>
          <li>Let <var>icons</var> be an empty list.
          </li>
          <li>Let <var>bookmark data URL</var> be the URL from which the
          <var>bookmark data </var>was fetched from.
          </li>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>bookmark data</var> passing
          "<code>icons</code>" as the argument.
          </li>
          <li>If <var>value</var> is an array, then for each <var>potential
          icon</var> in the array:
            <ol>
              <li>Let <var>src</var> be the result of running the <a>steps for
              processing the <code>src</code> member of an icon</a>. If the
              result is an error, stop processing this <var>potential
              icon</var> and move to the next <var>potential icon</var> in
              value (if available).
              </li>
              <li>Run the <a>steps for processing the <code>type</code> member
              of an icon</a>. If the result is an error,
              </li>
              <li>Let <var>width</var> be the result of running the <a>steps
              for processing the <code>width</code> member of an icon</a>. If
              the result is an error,
              </li>
              <li>Otherwise, let <var>icon</var> be an object.
              </li>
            </ol>
          </li>
          <li>return <var>icons</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>orientation</code> member
        </h3>
        <p>
          The <dfn id="member-orientation">orientation</dfn> <a>member</a>
          represents the screen orientation that is required to use the web
          application effectively. The value of this member is only applicable
          to applications whose mode of operation is <a>standalone</a>.
        </p>
        <p>
          Two orientations exists for most devices: 'portrait' and 'landscape',
          but some devices support only one. Devices might also support up to
          two portrait and two landscape orientations (described below), and by
          default be able to flip between all of these.
        </p>
        <p>
          Orientation-locking requests can be post-fixed with one of the
          following keywords:
        </p>
        <dl>
          <dt>
            primary
          </dt>
          <dd>
            The natural orientation for the device (if applicable, else an
            arbitrary one).
          </dd>
          <dt>
            secondary
          </dt>
          <dd>
            The opposite direction of the primary one.
          </dd>
          <dt>
            auto
          </dt>
          <dd>
            The choice of using either primary or secondary is left to the use
            agent.
          </dd>
        </dl>
        <p>
          When the request is not post-fixed, the user agent can flip between
          primary and secondary orientation.
        </p>
        <p>
          A <dfn>valid screen orientation</dfn> is a string that conforms to
          the following [[!ABNF]].
        </p>
        <pre>
  orientation = type ["-" option]
  type = "portrait" / "landscape"
  option = "any" / "primary" / "secondary" 
</pre>
        <p>
          The <dfn>steps for processing the <code>orientation</code>
          member</dfn> are given by the following algorithm. The algorithm
          returns a string.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>bookmark data</var> passing
          "<code>orientation</code>" as the argument.
          </li>
          <li>If <var>value</var> is <code>null</code> or
          <code>undefined</code>, return <code>undefined</code>.
          </li>
          <li>If <a>type</a>(<var>value</var>) is not "string", then return an
          error and terminate this algorithm.
          </li>
          <li>
            <a href=
            "http://www.whatwg.org/specs/web-apps/current-work/#strip-leading-and-trailing-whitespace">
            Strip leading and trailing whitespace</a> from <var>value</var>.
          </li>
          <li>If <var>value</var> is not a <a>valid screen orientation</a>,
          then return an error and terminate this algorithm.
          </li>
          <li>Return <var>value</var>.
          </li>
        </ol>
        <p>
          The <dfn>steps for selecting the orientation</dfn> is given by the
          following algorithm:<br>
        </p>
        <ol>
          <li>If the device is currently in either primary or secondary mode,
          choose the one that the device is currently in (unless there is some
          reason not to do so).
          </li>
          <li>if the device is in an orientation that is contrary to the one
          being requested, attempt to put the device into the primary or the
          orientation being requested.
          </li>
          <li>When the device is rotated, allow the document? to flip freely
          from primary to secondary.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code title="">mode</code> member
        </h3>
        <p>
          The <dfn title="member-mode">mode</dfn> member represents that mode
          of operation in which the web application will be launched. When the
          developer ommits the value, the user agent assumes the value "".
        </p>
        <p>
          Standalone mode can also be displayed in the following view modes:
        </p>
        <p>
          A <dfn>valid application mode</dfn> is one that conforms to the
          following [[!ABNF]]:
        </p>
        <pre>
  mode = "bookmark" / "standalone" ["-" viewmode] 
  viewmode = "fullscreen"
</pre>
        <p>
          The <dfn>steps for processing the <code>mode</code> member of an
          icon</dfn> are given by the following algorithm. The algorithm
          returns a string, an error, or <code>undefined</code>.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>bookmark data</var> passing
          "<code>mode</code>" as the argument.
          </li>
          <li>If <var>value</var> is <code>null</code> or
          <code>undefined</code>, return "<code>bookmark</code>".
          </li>
          <li>If <a>type</a>(<var>value</var>) is not "string", then return an
          error and terminate this algorithm.
          </li>
          <li>
            <a href=
            "http://www.whatwg.org/specs/web-apps/current-work/#strip-leading-and-trailing-whitespace">
            Strip leading and trailing whitespace</a> from <var>value</var>.
          </li>
          <li>If the value is an empty string, return "<code>bookmark</code>"
          and terminate this algorithm.
          </li>
          <li>If <var>value</var> is not a <a>valid application mode</a>, then
          return an error and terminate this algorithm.
          </li>
          <li>Return <var>value</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          Processing the bookmark description document
        </h3>
        <p>
          The <dfn>steps for fetching a bookmark description document</dfn> are
          given by the following algorithm. It takes a <var>url</var> URL as an
          argument. It returns either a <var>response</var> (which may be in
          error).
        </p>
        <ol>
          <li>Let <var>response</var> be the result of <a href=
          "http://fetch.spec.whatwg.org/#concept-fetch">fetching</a> the
          bookmark description document from <var>url</var>.
          </li>
          <li>Return <var>response</var>.
          </li>
        </ol>
        <p>
          The <dfn>steps to processing a bookmark description document</dfn>
          are given by the following algorithm. The algorithm takes a
          <var>text</var> string as an argument.
        </p>
        <ol>
          <li>Let <var>bookmark description doccument</var> be the result of
          invoking the <a href=
          "https://people.mozilla.com/~jorendorff/es6-draft.html#sec-15.12.2">
            parse</a> function of the JSON object defined in [[!ECMASCRIPT]]
            with <var>text</var> as its only argument. If parsing throws an
            error, return the error and terminate this algorithm.
          </li>
          <li>Let <var>name</var> be the result of running the <a>steps for
          processing the <code>name</code> member</a>. If the returned value is
          <code>undefined</code>:
            <ol>
              <li>Set <var>name</var> to be an implementation specific string
              that can serve as a suitable name for the web application. For
              example, if the bookmark description document was obtained from a <code>link</code>
              element, and the <code>document</code> has a <code>meta</code>
              element whose <code>name</code> attribute matches
                "<code><a href="http://www.whatwg.org/specs/web-apps/current-work/#meta-application-name">application-name</a></code>",
                then the user agent could use the value of that
                <code>meta</code> element's <code>content</code> attribute as a
                fallback. Otherwise, then the document's <code>title</code> can
                be used. Alternatively, the user could be prompted to provide a
                custom name using as a place holder.
              </li>
            </ol>
          </li>
          <li>Let <var>alternative name</var> be the result of running the <a>
            steps for processing the <code>altname</code> member</a>.
          </li>
          <li>Let <var>mode</var> be the result of running the <a>steps for
          processing the <code>mode</code> member</a>. If processing returns an
          error, report the error, and set <var>mode</var> to
          "<code>bookmark</code>".
          </li>
          <li>Let <var>orientation</var> be the result of running the <a>steps
          for processing the <code>orientation</code> member</a>.
          </li>
          <li>Let <var>url</var> be the result of running the <a>steps for
          processing the <code>url</code> member</a>.
          </li>
          <li>Let <var>icons</var> be the result of running the <a>steps for
          processing the <code>icons</code> member</a>.
          </li>
          <li>Optionally, <a>ignore</a> all other members.
          </li>
          <li>Return response.
          </li>
        </ol>
      </section>
      <section id="linking">
        <h3>
          Linking to a bookmark description document
        </h3>
        <p>
          The <code>bookmark-description</code> keyword can be used with a [[!HTML]]
          <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-link-element">
          link</a> element. This keyword creates an <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#external-resource-link"
          title="external resource link">external resource link</a>.
        </p>
        <table border="1">
          <tr>
            <th rowspan="2">
              Link type
            </th>
            <th colspan="2">
              Effect on...
            </th>
            <th rowspan="2">
              Brief description
            </th>
          </tr>
          <tr>
            <th>
              <code><a href="#the-link-element">link</a></code>
            </th>
            <th>
              <code><a href="#the-a-element">a</a></code> and <code><a href=
              "#the-area-element">area</a></code>
            </th>
          </tr>
          <tr>
            <td>
              <code title="rel-manifest">bookmark-description</code>
            </td><!-- second most used <link rel> value -->
            <td>
              <a href=
              "http://www.whatwg.org/specs/web-apps/current-work/#external-resource-link"
              title="external resource link">External Resource</a>
            </td>
            <td>
              not allowed
            </td>
            <td>
              Imports or links to a bookmark description document.
            </td>
          </tr>
        </table>
        <p>
          The default media type for resources associated with the
          <code>bookmark-description</code> link type is
          <code>application/webapp-bookmark+json</code>.
        </p>
        <p>
          In cases where more than one <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-link-element">
          <code>link</code></a> element with a <code>boomark-description</code> link type
          appears in a <code>document</code>, the user agent MUST use the first
          inserted link element and ignore all subsequent <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#the-link-element">
          <code>link</code></a> elements with a <code>bookmark-description</code> link type
          (even if the first element was in error).
        </p>
        <p>
          The appropriate time to <a>fetch</a> the bookmark description
          document is when the <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#external-resource-link"
          title="external resource link">external resource link</a> is created
          or when its element is <a href=
          "http://www.whatwg.org/specs/web-apps/current-work/#insert-an-element-into-a-document"
          title="insert an element into a document">inserted into a
          document</a>, whichever happens last. However, a user agent MAY opt
          to delay fetching a bookmark description document until after the
          document and its other resources have loaded (i.e., to not delay the
          availability of content and scripts required by the
          <code>document</code>).
        </p>
        <p>
          Certain error conditions can result in a bookmark description
          document being treated as an <a>invalid bookmark description
          document</a>. An <dfn>invalid bookmark description document</dfn> is
          one that is deemed to be non-conforming in such a way that it would
          not be possible for the user agent to continue processing (e.g., it
          can't be parsed by the JSON parser because of a syntax error, it
          could be fetched from the network). In such a case, the user agent
          MAY report the error to the user in a user-agent-specific manner, or
          MAY ignore the error and do nothing. In either case, when a step
          results in an <a>invalid bookmark description document</a> the user
          agent MUST abort whatever step or sub-step caused the condition.
        </p>
        <p>
          To fetch a bookmark description document, as user agent MUST:
        </p>
        <ol>
          <li>If the <code>link</code> element lacks a href attribute, abort
          this algorithm.
          </li>
          <li>Run the <a>steps for fetching a bookmark description
          document</a>, with the value of <code>href</code> attribute as the
          url, and let <var>response</var> be the response.
          </li>
          <li>If response's type is "error", treat this as an <span>invalid
          bookmark description document</span>.
          </li>
          <li>Otherwise, let <var>bookmark description</var> be the result of
          running the <a>steps for processing a bookmark description
          document</a>.
          </li>
          <li>If <var>bookmark description</var> results in an error, treat
          this as an <span>invalid bookmark description document</span>.
          </li>
          <li>Otherwise, in a user agent specific manner, and when the end-user
          so desires, provide a means for the end-user to view the relevant
          contents of the <var>bookmark description</var>; and provide a means
          for the end-user to create a bookmark based on that information.
          </li>
        </ol>
      </section>
      <section id="proprietary-extensions" class="informative">
        <h3>
          Proprietary extensions to the bookmark description document
        </h3>
        <p>
          Although proprietary extensions are undesirable, they can't
          realistically be avoided. As such, the RECOMMENDED way to add
          proprietary extension is to use a vendor prefix.
        </p> 
        <p>
            This following is an example of two hypothetical vendor extensions.
        </p>
        <pre class="example highlight json" title="vendor extensions">
{
  ...
  "webkit-fancyfeature": "some/url/img",
  "moz-awesome-thing": { ... }
  ...
}</pre></div>

      </section>
    </section>
    <section>
      <h2>
        Launching a standalone web application
      </h2>
      <p>
        When an application is launched:
      </p>
      <ol>
        <li>If the web application has a required orientation, run the
        <span>steps for selecting the orientation</span>.
        </li>
      </ol>
    </section>
    <section>
      <h2>
        Icon object and its members
      </h2>
      <p>
        Each <dfn>icons object</dfn> represents an icon for an application
        suitable to use at some dimensions and screen density.
      </p>
      <section>
        <h3>
          <code>density</code> member
        </h3>
        <p>
          The <dfn title="icon-densitiy">density</dfn> member of an icon is the
          device pixel density for which this icon was designed. The device
          pixel density is expressed as the number of dots per 'px' unit
          (equivalent to a <a href=
          "http://dev.w3.org/csswg//#resolution">dppx</a> as defined in
          [[!css3-values]]). The value is a positive number greater than 0. If
          the developer ommits the value, the user agent assumes the value
          <a><code>1</code></a>.
        </p>
        <p>
          The <dfn>steps for processing a density of an icon</dfn> are given by
          the following algorithm. The algorithm returns a positive number,
          <code>undefined</code>, or an error.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>icon</var> passing
          "<code>density</code>" as the argument.
          </li>
          <li>If value is <code>undefined</code>, return 1.
          </li>
          <li>Let <var>number</var> be the result of
          parseFloat(<var>value</var>);
          </li>
          <li>If <var>number</var> is <code>NaN</code>, +0, −0, +∞, or −∞, or
          less than 0, return an error.
          </li>
          <li>Return <var>number</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>width</code> and <code title="">height</code> members
        </h3>
        <p>
          The <dfn title="icon-width">width</dfn> and <dfn title=
          "icon-height">height</dfn> members represent the natural width of the
          icon in pixels. Their corresponding value is a positive number
          greater than 0.
        </p>
        <p>
          The <dfn>steps for processing a dimension of an icon</dfn> are given
          by the following algorithm. The algorithm takes an <var>icon</var>
          and a <var>key</var> ('width" or "height") as an argument. The
          algorithm returns a positive number, <code>undefined</code>, or an
          error.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>object</var> passing
          <var>key</var> as the argument.
          </li>
          <li>If value is <code>undefined</code>, return
          <code>undefined</code>.
          </li>
          <li>Let <var>number</var> be the result of
          parseFloat(<var>value</var>);
          </li>
          <li>If <var>number</var> is <code>NaN</code>, +0, −0, +∞, or −∞, or
          less than 0, return an error.
          </li>
          <li>Return <var>number</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>src</code> member
        </h3>
        <p>
          The <dfn title="icon-density">src</dfn> member of an icon is a URL
          from which the icon can be fetched.
        </p>
        <p>
          The <dfn>steps for processing the <code>src</code> member of an
          icon</dfn> are given by the following algorithm. The algorithm takes
          a <var>potential icon</var> object as an argument. The algorithm
          returns a URL or an error.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
          [[\GetOwnProperty]] internal method of <var>potential icon</var>
          passing "<code>src</code>" as the argument.
          </li>
          <li>If <var>value</var> is <code>null</code> or
          <code>undefined</code> or type(<var>potential src</var>) is not
          "string", return an error.
          </li>
          <li>Let <var>bookmark description URL</var> be the URL from which the <var>bookmark description document</var> was fetched from. </li>
          <li>
            <a href="http://url.spec.whatwg.org/#parsing">Parse</a> <var>value</var>, using <var>bookmark description URL</var> as the base URL, and let
            <var>result</var> be the result.
          </li>
          <li>return <var>result</var>.
          </li>
        </ol>
      </section>
      <section>
        <h3>
          <code>type</code> member
        </h3>
        <p>
          The <dfn title="icon-type">type</dfn> member of an icon is a hint as
          to the media type of the icon. The purpose of this member is to allow a user agent can ignore icons of media
          types it does not support.
        </p>
        <p>
          The <dfn>steps for processing the <code>type</code> member</dfn> are
          given by the following algorithm. The algorithm returns a string or
          <code>undefined</code>.
        </p>
        <ol>
          <li>Let <var>value</var> be the result of calling the
            [[\GetOwnProperty]] internal method of <var>potential icon</var> passing "<code>type</code>" as the argument. </li>
          <li>If <var>value</var> is <code>null</code> or <code>undefined</code> or type(<var>potential src</var>) is not
            "string", return an error. </li>
          <li>Let <var>bookmark description URL</var> be the URL from which the <var>bookmark description document</var> was fetched from. </li>
          <li> <a href=
            "http://www.whatwg.org/specs/web-apps/current-work/#strip-leading-and-trailing-whitespace"> Strip leading and trailing whitespace</a> from <var>result</var>. </li>
          <li>return <var>result</var>. </li>
        </ol>
      </section>
    </section>
    <section>
      <h2>
        Extensions to the <code>Navigator</code> object
      </h2>
      <dl class="idl" title="partial interface Navigator">
        <dt>
          readonly attribute Boolean standalone
        </dt>
        <dd>
          The standalone attribute provides a means for a developer to check if
          the applicatoin is running in <a>standalone</a> mode. When getting, the user
          agent MUST returns <code>true</code> if the application is running as
          <a>standalone</a>. Return <code>false</code> otherwise.
        </dd>
        <dt>
          Promise requestBookmark(DOMString url)
        </dt>
        <dd>
          When invoked, the user agent MUST run the <a>steps to request to add
          bookmark</a>.
        </dd>
      </dl>
      <p>
        The <dfn>steps to request to add bookmark</dfn> are given by the
        following algorithm. The algorithm runs asynchronously and returns a
        Promise.
      </p>
      <ol>
        <li>Let <var>promise</var> be a new <a><code>Promise</code></a> object
        and <var>resolver</var> its associated resolver.
        </li>
        <li>Return <var>promise</var> and run the remaining steps
        asynchronously.
        </li>
        <li>If this method was not invoked as a result of explicit user action,
        then:
          <ol>
            <li>Let <var>error</var> be a new <a><code>DOMException</code></a>
            whose name is "<code><a href=
            "http://dom.spec.whatwg.org/#securityerror">SecurityError</a></code>".
            </li>
            <li>Run resolver's internal reject algorithm with <var>error</var>
            as value and terminate this algorithm.
            </li>
          </ol>
        </li>
        <li>Run the <a>steps for fetching a bookmark description document</a>.
        If the <var>response</var>'s type is "error":
          <ol>
            <li>Let exception name be "<code><a href=
            "http://dom.spec.whatwg.org/#networkerror">NetworkError</a></code>".
            </li>
            <li>If the <var>response</var>'s termination reason is end user
            abort, set <var>exception name</var> to "<code><a href=
            "http://dom.spec.whatwg.org/#aborterror">AbortError</a></code>".
            </li>
            <li>If the <var>response</var>'s termination reason is timeout, set
            <var>exception name</var> to "<code><a href=
            "http://dom.spec.whatwg.org/#timeouterror">TimeoutError</a></code>".
            </li>
            <li>Let <var>error</var> be a new <a><code>DOMException</code></a>
            whose name is <var>exception name</var>.
            </li>
            <li>Run <var>resolver</var>'s internal reject algorithm with <var>
              error</var> as value and terminate this algorithm.
            </li>
          </ol>
        </li>
        <li>Let <var>boomark info</var> be result of the <a>steps for
        processing a bookmark description document</a>, with
        <var>response</var>'s <a href=
        "http://fetch.spec.whatwg.org/#concept-response-body">body</a> as the
        argument.
        </li>
        <li>If <var>boomark info</var> is an error:
          <ol>
            <li>Run <var>resolver</var>'s internal reject algorithm with <var>
              error</var> as value and terminate this algorithm.
            </li>
          </ol>
        </li>
        <li>Present <var>bookmark info</var> to the end user. If the end-user
        rejects the request to add the bookmark:
          <ol>
            <li>Let <var>error</var> be a new <a><code>DOMException</code></a>
            whose name is "<code><a href=
            "http://dom.spec.whatwg.org/#aborterror">AbortError</a></code>".
            </li>
            <li>Run <var>resolver</var>'s internal reject algorithm with <var>
              error</var> as value and terminate this algorithm.
            </li>
          </ol>
        </li>
        <li>Run <var>resolver</var>'s internal fulfill algorithm with
        <var>undefined</var> as value.
        </li>
      </ol>
  </section>
    <section>
      <h2>
        Media type reregistration
      </h2>
      <p>
        This section contains the required text for MIME media type
        registration with IANA.
      </p>
      <p>
        The <dfn>media type for a bookmark description documents</dfn> is
        <code>application/bookmark+json</code>.
      </p>
      <p>
        If the protocol over which the bookmark description document is
        transferred supports the [[!MIME-TYPES]] specification (e.g. HTTP), it
        is RECOMMENDED that the bookmark description document be labeled with
        the <a>media type for a bookmark description documents</a>.
      </p>
      <dl>
        <dt>
          Type name:
        </dt>
        <dd>
          application
        </dd>
        <dt>
          Subtype name:
        </dt>
        <dd>
          bookmark+json
        </dd>
        <dt>
          Required parameters:
        </dt>
        <dd>
          N/A
        </dd>
        <dt>
          Optional parameters:
        </dt>
        <dd>
          N/A
        </dd>
        <dt>
          Encoding considerations:
        </dt>
        <dd>
          Same as for application/json
        </dd>
        <dt>
          Security considerations:
        </dt>
        <dd>
          <p>
            As the bookmark description document format is JSON and will
            commonly be encoded using [[!UNICODE]], the security considerations
            described in [[!JSON]] and [[!UNICODE-SECURITY]] apply. In
            addition, implementors need to impose their own
            implementation-specific limits on the values of otherwise
            unconstrained member types, e.g. to prevent denial of service
            attacks, to guard against running out of memory, or to work around
            platform-specific limitations.
          </p>
          <p>
            Web applications will generally contain ECMAScript, HTML, CSS
            files, and other media, which are executed in a sand-boxed
            environment. As such, implementors need to be aware of the security
            implications for the types they support. Specifically, implementors
            need to consider the security implications outlined in the
            [[!CSS-MIME]] specification, the [[!ECMAScript-MIME]]
            specification, and the [[!HTML]] specification.
          </p>
          <p>
            As web applications can contain content that is able to
            simultaneously interact with the local device and a remote host,
            implementors need to consider the privacy implications resulting
            from exposing private information to a remote host. Mitigation and
            in-depth defensive measures are an implementation responsibility
            and not prescribed by this specification. However, in designing
            these measures, implementors are advised to enable user awareness
            of information sharing, and to provide easy access to interfaces
            that enable revocation of permissions.
          </p>
          <p>
            As this specification allows for the declaration of URLs within
            certain members of a bookmark description document, implementors
            need to consider the security considerations discussed in the
            [[!URL]] specification. Implementations intending to display
            <abbr title="Internationalized Resource Identifiers">IRIs</abbr>
            and <abbr title="Internationalized domain name">IDNA</abbr>
            addresses found in the bookmark description document are strongly
            encouraged to follow the security advice given in
            [[!UNICODE-SECURITY]].
          </p>
        </dd>
        <dt>
          Applications that use this media type:
        </dt>
        <dd>
          Web browsers
        </dd>
        <dt>
          Additional information:
        </dt>
        <dd>
          <dl>
            <dt>
              Magic number(s):
            </dt>
            <dd>
              N/A
            </dd>
            <dt>
              File extension(s):
            </dt>
            <dd>
              .bdd, .json
            </dd>
            <dt>
              Macintosh file type code(s):
            </dt>
            <dd>
              TEXT
            </dd>
          </dl>
        </dd>
        <dt>
          Person &amp; email address to contact for further information:
        </dt>
        <dd>
          The <a href="http://www.w3.org/2008/webapps/" rel="nofollow">Web
          Applications (WebApps) Working Group</a> can be contacted at <a href=
          "http://lists.w3.org/Archives/Public/public-webapps/" rel=
          "nofollow">public-webapps@w3.org</a>.
        </dd>
        <dt>
          Intended usage:
        </dt>
        <dd>
          COMMON
        </dd>
        <dt>
          Restrictions on usage:
        </dt>
        <dd>
          none
        </dd>
        <dt>
          Author:
        </dt>
        <dd>
          W3C's Web Applications (WebApps) Working Group.
        </dd>
        <dt>
          Change controller:
        </dt>
        <dd>
          W3C.
        </dd>
      </dl>
    </section>
    <section class="appendix">
      <h2>
        Acknowledgments
      </h2>
      <p>
        This document reuses text from the WHATWG [[!HTML]] specification as
        permitted by the license of that specification. The [[!HTML]]
        specification is edited by Ian Hickson.
      </p>
    </section>
  </body>
</html>
